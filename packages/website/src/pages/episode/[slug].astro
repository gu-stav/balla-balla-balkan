---
import Layout from '../../layouts/Layout.astro';
import { getEpisode, getEpisodes } from '../../utils/episodes';
import { PortableText } from "astro-portabletext";
import EpisodeLatest from '../../components/EpisodeLatest.astro';
import { components } from '../../components/PortableText';

const { slug } = Astro.params;
const episode = await getEpisode(slug);

export async function getStaticPaths() {
    const episodes = await getEpisodes();

  return episodes.map((episode) => ({
    params: {
      slug: episode.slug
    }
  }));
}
---
<Layout title={episode.title} image={episode.ogImage ? `${episode.ogImage}?h=630&w=1280` : `${episode.imageUrl}?fit=fillmax&h=630&w=1280&bg=faffbd`} description={episode.excerpt}>
    <article>
        <div class="flex flex-col gap-8 items-center pb-6 w-full">
            <EpisodeLatest episode={episode} list={false} />
        </div>

        <div class="flex flex-col gap-4 max-w-5xl px-4 sm:px-16 text-xl">
            <PortableText components={components} value={episode.richtext} />
        </div>
    </article>
</Layout>
